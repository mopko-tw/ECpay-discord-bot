# ECPay Discord Bot v1.5.0

一個整合ECPay多種付款方式的Discord機器人，支援全中文指令、信用卡、ATM、超商代碼/條碼、行動支付等多種付款方式。

## 🆕 v1.5.0 新功能

### 💳 多種付款方式支援
- **💳 信用卡付款**：一次付清和分期付款（3/6/12/18/24期）
- **🏧 網路ATM**：線上金融卡轉帳付款
- **🏧 ATM櫃員機**：實體ATM轉帳付款
- **🏪 超商代碼**：傳統超商代碼繳費
- **📊 超商條碼**：超商條碼掃描繳費
- **📱 Google Pay**：Google行動支付（需特別申請）
- **🍎 Apple Pay**：Apple行動支付

### 🔧 新增指令
- **`/建立付款單`**：全新的多付款方式指令
- **智慧參數驗證**：根據付款方式自動檢查必要參數
- **動態金額限制**：不同付款方式有不同的金額上限
- **分期付款支援**：信用卡分期期數選擇

### 📊 增強功能
- **付款方式特定資訊**：每種付款方式顯示對應的付款資訊
- **詳細操作指南**：針對不同付款方式提供專屬操作步驟
- **向後兼容**：保留原有的 `/建立繳費單` 指令
- **智慧embed顯示**：根據付款方式動態調整顏色和圖示

## ✨ 主要功能

### 🎯 全中文指令系統
- `/建立繳費單` - 建立ECPay超商繳費單（舊版，向後兼容）
- `/建立付款單` - 建立ECPay付款單（支援多種付款方式）
- `/查詢付款狀態` - 查詢付款狀態  
- `/繳費說明` - 顯示繳費功能說明
- `/help` - 顯示所有指令說明
- `/機器人資訊` - 查看機器人詳細資訊
- `/系統狀況` - 查看系統狀況（僅擁有者）

### 💳 付款方式詳細說明

#### 信用卡付款
- **一次付清**：支援所有主要信用卡
- **分期付款**：3、6、12、18、24期可選
- **金額限制**：NT$ 1 - 1,000,000
- **付款流程**：線上刷卡，即時完成

#### ATM付款
- **網路ATM**：線上金融卡轉帳，需讀卡機
- **ATM櫃員機**：實體ATM轉帳，提供虛擬帳號
- **金額限制**：NT$ 1 - 50,000
- **付款期限**：3天內完成轉帳

#### 超商付款
- **超商代碼**：傳統代碼繳費方式
- **超商條碼**：條碼掃描繳費，支援三組條碼
- **金額限制**：NT$ 1 - 20,000
- **付款期限**：7天內完成繳費

#### 行動支付
- **Google Pay**：Android裝置專用（需特別申請）
- **Apple Pay**：iOS裝置專用，支援Touch ID/Face ID
- **金額限制**：依各平台規定
- **付款流程**：手機驗證，快速完成

### 🏪 超商選擇系統（超商付款專用）
- **🏪 全通用**：適用所有支援超商，顯示ibon代碼+一般代碼
- **🏪 7-ELEVEN**：專用ibon機台，14位數代碼
- **🏪 全家便利商店**：FM開頭12位數代碼
- **🏪 萊爾富**：HL開頭10位數代碼  
- **🏪 OK便利商店**：OK開頭11位數代碼

### 🔧 配置系統
- **WebUI模式**：網頁配置介面 (http://localhost:5000)
- **終端模式**：命令列互動配置
- **身分組權限**：支援多身分組權限控制
- **擁有者權限**：bot擁有者專用管理功能
- **測試/正式環境**：可切換ECPay環境

### 📊 系統監控
- **CPU監控**：使用率、核心數、邏輯核心
- **記憶體監控**：使用率、已使用、總容量
- **磁碟監控**：使用率、已使用、總容量
- **網路統計**：發送/接收流量、封包統計
- **程序監控**：Bot記憶體使用、CPU使用率
- **溫度監控**：硬體溫度顯示（支援的系統）
- **系統負載**：1/5/15分鐘平均負載（Unix/Linux）

### 📊 日誌管理
- **等級控制**：DEBUG/INFO/WARNING/ERROR/CRITICAL
- **顯示控制**：終端日誌、後端框架日誌開關
- **檔案管理**：輪轉日誌、大小限制、備份數量
- **格式自訂**：可自訂日誌輸出格式

## 🚀 快速開始

### 1. 環境需求
- Python 3.8+
- Discord Bot Token
- ECPay商家帳號

### 2. 安裝依賴
```bash
pip install -r requirements.txt
```

### 3. 配置設定
複製 `config.example.py` 為 `config.py` 並修改配置：

```python
# Discord Bot 配置
DISCORD_BOT_TOKEN = "YOUR_DISCORD_BOT_TOKEN_HERE"

# Bot擁有者ID（用於管理指令）
BOT_OWNER_ID = 123456789012345678  # 替換為您的Discord用戶ID

# 是否使用WebUI配置介面
USE_WEB_UI = False  # True: 網頁配置, False: 終端配置

# ECPay 配置
ECPAY_CONFIG = {
    "MerchantID": "YOUR_MERCHANT_ID_HERE",
    "HashKey": "YOUR_HASH_KEY_HERE", 
    "HashIV": "YOUR_HASH_IV_HERE",
    "ExpireDate": 7,  # 繳費期限(天)
}
```

### 4. 啟動機器人
```bash
python main.py
```

## 📋 指令說明

### 💳 付款相關指令

#### `/建立付款單`（推薦使用）
建立ECPay多種付款方式付款單

**參數：**
- `金額` (必填)：付款金額
- `說明` (必填)：交易說明
- `付款方式` (必填)：選擇付款方式
- `商品名稱` (選填)：商品名稱，預設為"商品"
- `超商選擇` (條件)：超商付款時必填
- `分期期數` (條件)：信用卡分期時必填

**付款方式選項：**
- 💳 信用卡（一次付清）
- 💳 信用卡分期付款
- 🏧 網路ATM
- 🏧 ATM櫃員機
- 🏪 超商代碼
- 📊 超商條碼
- 📱 Google Pay
- 🍎 Apple Pay

**金額限制：**
- 超商付款：NT$ 1 - 20,000
- 信用卡付款：NT$ 1 - 1,000,000
- ATM付款：NT$ 1 - 50,000

#### `/建立繳費單`（舊版，向後兼容）
建立ECPay超商繳費單

**參數：**
- `金額` (必填)：繳費金額 (1-20,000元)
- `說明` (必填)：交易說明
- `超商選擇` (必填)：選擇指定超商或全通用
- `商品名稱` (選填)：商品名稱，預設為"商品"

#### `/查詢付款狀態`
查詢指定交易的付款狀態

**參數：**
- `交易編號` (必填)：要查詢的交易編號

#### `/繳費說明`
顯示ECPay付款功能的詳細說明

### ℹ️ 資訊指令

#### `/help`
顯示所有可用指令的說明，根據用戶權限動態顯示

#### `/機器人資訊`
查看機器人詳細資訊

### 🔧 管理指令（僅擁有者）

#### `/系統狀況`
查看伺服器系統狀況，僅bot擁有者可使用

## 💳 付款流程詳解

### 信用卡付款
1. 使用 `/建立付款單` 選擇信用卡付款
2. 點擊付款連結或開啟HTML檔案
3. 輸入信用卡資訊和安全驗證碼
4. 選擇分期期數（如為分期付款）
5. 確認交易資訊並完成付款

### 網路ATM付款
1. 使用 `/建立付款單` 選擇網路ATM
2. 點擊付款連結
3. 選擇您的銀行
4. 插入金融卡並輸入密碼
5. 確認交易資訊並完成轉帳

### ATM櫃員機付款
1. 使用 `/建立付款單` 選擇ATM櫃員機
2. 記下銀行代碼和虛擬帳號
3. 前往任一ATM櫃員機
4. 選擇轉帳功能並輸入資訊
5. 完成轉帳並保留明細

### 超商代碼付款
1. 使用 `/建立付款單` 選擇超商代碼
2. 選擇指定超商或全通用
3. 記下繳費代碼
4. 前往指定超商告知店員「代碼繳費」
5. 提供代碼並完成繳費

### 超商條碼付款
1. 使用 `/建立付款單` 選擇超商條碼
2. 記下三組條碼資訊
3. 前往任一支援超商
4. 告知店員「條碼繳費」並出示條碼
5. 店員掃描條碼後完成繳費

### 行動支付
1. 使用 `/建立付款單` 選擇Google Pay或Apple Pay
2. 點擊付款連結
3. 選擇對應的行動支付方式
4. 使用手機驗證（指紋/臉部/密碼）
5. 確認付款資訊並完成付款

## ⚙️ 配置選項

### 付款方式配置
ECPay處理模組會自動根據選擇的付款方式設定對應的參數：

```python
# 付款方式對應表（自動處理）
payment_methods = {
    'CREDIT': 'Credit',           # 信用卡
    'WEBATM': 'WebATM',          # 網路ATM
    'ATM': 'ATM',                # ATM櫃員機
    'CVS': 'CVS',                # 超商代碼
    'BARCODE': 'BARCODE',        # 超商條碼
    'GOOGLEPAY': 'GooglePay',    # Google Pay
    'APPLEPAY': 'ApplePay'       # Apple Pay
}
```

### 金額限制配置
不同付款方式有不同的金額限制：

```python
# 金額限制（自動檢查）
limits = {
    'CVS': 20000,        # 超商付款上限
    'BARCODE': 20000,    # 超商條碼上限
    'CREDIT': 1000000,   # 信用卡上限
    'ATM': 50000,        # ATM上限
    'WEBATM': 50000      # 網路ATM上限
}
```

## 🔒 權限設定

### 身分組權限
在 `ALLOWED_ROLE_IDS` 中設定允許使用付款指令的Discord身分組ID：

```python
ALLOWED_ROLE_IDS = [
    123456789012345678,  # 管理員身分組
    987654321098765432,  # 其他身分組
]
```

### 擁有者權限
設定bot擁有者ID，擁有最高權限：

```python
BOT_OWNER_ID = 123456789012345678  # bot擁有者用戶ID
```

**權限等級：**
1. **一般用戶**：可使用 `/help`、`/機器人資訊`
2. **身分組用戶**：可使用所有付款相關指令
3. **Bot擁有者**：可使用所有指令，包括 `/系統狀況`

## 📁 專案結構

```
ecpay/
├── main.py                 # 主程式
├── config.py              # 配置檔案
├── config.example.py      # 配置範例
├── ecpay_handler.py       # ECPay處理模組（支援多種付款方式）
├── requirements.txt       # 依賴套件
├── commands/              # 指令模塊
│   ├── __init__.py
│   └── payment_commands.py # 付款指令（包含新的多付款方式）
├── readme/                # 文件資料夾
│   ├── README_v1.0.0.md
│   ├── README_v1.1.0.md
│   ├── README_v1.3.0.md
│   ├── README_v1.4.0.md
│   └── README_v1.5.0.md   # 最新版本
└── bot.log               # 日誌檔案
```

## 🔧 故障排除

### 常見問題

1. **付款方式不支援**
   - 確認ECPay商家後台已開通對應付款方式
   - Google Pay需要特別申請才能使用
   - 檢查付款方式的金額限制

2. **分期付款失敗**
   - 確認信用卡支援分期功能
   - 檢查分期期數是否在允許範圍內
   - 確認金額符合分期最低要求

3. **ATM付款問題**
   - 確認虛擬帳號格式正確
   - 檢查銀行代碼是否有效
   - 注意ATM付款期限為3天

4. **超商付款問題**
   - 確認選擇的超商類型正確
   - 檢查繳費代碼格式
   - 注意超商付款期限為7天

5. **行動支付問題**
   - 確認裝置支援對應的行動支付
   - 檢查行動支付帳戶設定
   - 確認網路連線正常

### 除錯建議

1. **啟用詳細日誌**
   ```python
   LOG_CONFIG = {
       "level": "DEBUG",
       "show_console": True,
       "show_backend": True,
   }
   ```

2. **檢查ECPay設定**
   - 驗證MerchantID、HashKey、HashIV
   - 確認測試/正式環境設定
   - 檢查商家後台付款方式設定

3. **測試付款流程**
   - 先使用測試環境驗證
   - 測試小額付款
   - 確認回調網址設定

## 📞 技術支援

如有問題請檢查：
1. 日誌檔案 (`bot.log`)
2. 配置檔案設定
3. Discord Bot權限
4. ECPay商家後台設定
5. 付款方式開通狀況
6. 金額限制和期限設定

## 📄 授權

此專案僅供學習和測試使用。

---

**ECPay Discord Bot v1.5.0** - 支援全中文指令、多種付款方式、進階日誌管理、系統監控 